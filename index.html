<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­Œæ›²æäº¤ç³»ç»Ÿ</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
        input, button { padding: 10px; margin: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 10px; text-align: left; }
    </style>
</head>
<body>

    <h2>æäº¤ä½ çš„æ­Œæ›²</h2>
    
    <label for="letter">é€‰æ‹©å­—æ¯ï¼š</label>
    <select id="letter">
        <script>
            for (let i = 65; i <= 90; i++) {
                document.write(`<option value="${String.fromCharCode(i)}">${String.fromCharCode(i)}</option>`);
            }
        </script>
    </select>

    <input type="text" id="songName" placeholder="è¾“å…¥æ­Œæ›²å">
    <button onclick="submitSong()">æäº¤</button>

    <p id="response"></p>

    <h2>å½“å‰æäº¤çš„æ­Œæ›²</h2>
    <button onclick="loadSongs()">ğŸ”„ åŠ è½½æ­Œæ›²</button> <!-- æ·»åŠ åˆ·æ–°æŒ‰é’® -->

    <table id="songTable">
        <thead>
            <tr>
                <th>å­—æ¯</th>
                <th>æ­Œæ›²åˆ—è¡¨</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // æäº¤æ­Œæ›²
        function submitSong() {
            var letter = document.getElementById("letter").value;
            var songName = document.getElementById("songName").value.trim();
            var responseText = document.getElementById("response");

            if (!songName) {
                responseText.innerHTML = "âŒ è¯·è¾“å…¥æ­Œæ›²åç§°";
                return;
            }

            var apiUrl = "https://script.google.com/macros/s/AKfycbxfb32PDJHxn8WNruYX1ApaSIU33R8QAk53ihO4x_zIaND3Qi5tEXt0voVqoenwbq8bag/exec?letter=" + encodeURIComponent(letter) + "&song=" + encodeURIComponent(songName);

            console.log("è¯·æ±‚ API:", apiUrl);

            fetch(apiUrl)
                .then(response => response.text())
                .then(data => {
                    console.log("æœåŠ¡å™¨è¿”å›:", data);
                    responseText.innerHTML = "âœ… " + data;
                    loadSongs(); // æäº¤æˆåŠŸåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
                })
                .catch(error => {
                    console.error("Fetch é”™è¯¯:", error);
                    responseText.innerHTML = "âŒ æäº¤å¤±è´¥ï¼š" + error;
                });
        }

        // åŠ è½½å·²æäº¤çš„æ­Œæ›²ï¼ˆå¹¶æŒ‰ A-Z æ’åˆ—ï¼‰
        function loadSongs() {
            var apiUrl = "https://script.google.com/macros/s/AKfycbxfb32PDJHxn8WNruYX1ApaSIU33R8QAk53ihO4x_zIaND3Qi5tEXt0voVqoenwbq8bag/exec?action=getSongs";
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    console.log("å·²æäº¤çš„æ­Œæ›²:", data);
                    var tableBody = document.querySelector("#songTable tbody");
                    tableBody.innerHTML = ""; // æ¸…ç©ºæ—§æ•°æ®

                    // ç”Ÿæˆ A-Z é¡ºåºçš„æ•°ç»„
                    var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
                    
                    alphabet.forEach(letter => {
                        var row = document.createElement("tr");

                        var cellLetter = document.createElement("td");
                        cellLetter.textContent = letter;
                        row.appendChild(cellLetter);

                        var cellSongs = document.createElement("td");
                        cellSongs.textContent = data[letter] && data[letter].length > 0 ? data[letter].join(", ") : "æš‚æ— æ­Œæ›²";
                        row.appendChild(cellSongs);

                        tableBody.appendChild(row);
                    });
                })
                .catch(error => console.error("è·å–æ­Œæ›²å¤±è´¥:", error));
        }

        // é¡µé¢åŠ è½½æ—¶ä¸è‡ªåŠ¨è·å–æ•°æ®ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®åŠ è½½
    </script>

</body>
</html>
